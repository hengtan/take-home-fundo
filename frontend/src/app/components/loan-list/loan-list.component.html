<div class="overflow-x-auto rounded-xl shadow-md">
  <table class="min-w-full text-sm border-separate border-spacing-y-1">
    <thead>
    <tr class="bg-slate-100 text-left text-xs font-semibold uppercase">
      <th class="px-4 py-2">Solicitante</th>
      <th class="px-4 py-2">Valor</th>
      <th class="px-4 py-2">Saldo Atual</th>
      <th class="px-4 py-2">Status</th>
    </tr>
    </thead>
    <tbody>
    <ng-container *ngFor="let loan of loans">
      <!-- Linha resumida -->
      <tr (click)="onRowClick(loan)"
          class="bg-white hover:bg-blue-50 cursor-pointer transition group"
          [class.border-b-0]="selectedLoanId === loan.id">
        <td class="px-4 py-3 font-medium">{{ loan.applicantName }}</td>
        <td class="px-4 py-3">{{ loan.amount | currency:'USD' }}</td>
        <td class="px-4 py-3">{{ loan.currentBalance | currency:'USD' }}</td>
        <td class="px-4 py-3">
            <span [ngClass]="{
                'bg-yellow-500 text-white': loan.status === 'Active',
                'bg-green-600 text-white': loan.status === 'Paid'
              }" class="px-3 py-1 rounded-full text-xs font-bold shadow">
              {{ loan.status }}
            </span>
        </td>
      </tr>
      <!-- Linha de detalhe expandida -->
      <tr *ngIf="selectedLoanId === loan.id" class="bg-slate-50">
        <td colspan="4" class="p-0">
          <div class="flex flex-col gap-4 p-5 border border-t-0 rounded-b-xl shadow-inner">
            <ng-container *ngIf="loadingDetail">
              <div class="flex gap-3 items-center">
                <span class="animate-spin inline-block w-5 h-5 border-2 border-blue-400 border-t-transparent rounded-full"></span>
                <span class="text-slate-500">Carregando detalhes do empréstimo...</span>
              </div>
            </ng-container>
            <ng-container *ngIf="selectedLoan && !loadingDetail">
              <div class="flex flex-col gap-2">
                <div><span class="font-semibold text-slate-700">ID:</span> {{ selectedLoan.id }}</div>
                <div><span class="font-semibold text-slate-700">Solicitante:</span> {{ selectedLoan.applicantName }}</div>
                <div><span class="font-semibold text-slate-700">Valor:</span> {{ selectedLoan.amount | currency:'USD' }}</div>
                <div><span class="font-semibold text-slate-700">Saldo Atual:</span> {{ selectedLoan.currentBalance | currency:'USD' }}</div>
                <div>
                  <span class="font-semibold text-slate-700">Status:</span>
                  <span [ngClass]="{
                'bg-yellow-500 text-white': selectedLoan.status === 'Active',
                'bg-green-600 text-white': selectedLoan.status === 'Paid'
              }" class="px-2 py-1 rounded text-xs font-bold ml-2">{{ selectedLoan.status }}</span>
                </div>
              </div>
            </ng-container>
            <button type="button"
                    (click)="onRowClick(loan)"
                    class="ml-auto mt-2 text-xs text-blue-700 hover:underline hover:text-blue-900">
              Fechar
            </button>
          </div>
        </td>
      </tr>
    </ng-container>
    <!-- Se lista vazia -->
    <tr *ngIf="loans.length === 0 && !loadingDetail">
      <td colspan="4" class="text-center py-6 text-slate-400">
        Nenhum empréstimo encontrado.
      </td>
    </tr>
    </tbody>
  </table>
</div>
